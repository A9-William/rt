Hello, looks like it's new intallation of RT.

We're going to bla-bla... intstall RT

<form method="post">
% for ( my $i = 0; $i < @db_options; $i += 2 ) {
% my $option = $db_options[$i];
% my $meta = $db_options[$i+1];
<& $meta->{'Widget'},
    Default      => 0,
    %{ $meta->{'WidgetArguments'} },
    Name         => $option,
    CurrentValue => scalar RT->Config->Get( $option ),
&>
% }

<& /Elements/Submit, Name => 'DatabaseCreate', Label => loc('Create database') &>

</form>

<%FLAGS>
inherit => undef
</%FLAGS>
<%ARGS>
</%ARGS>
<%INIT>
my @db_options = (
    DatabaseType => {
        Section         => 'Database', #loc
        Widget          => '/Widgets/Form/Select',
        WidgetArguments => {
            Description => 'Type of the database where RT will store its data', #loc
            Values      => [qw(mysql Pg Oracle SQLite)],
            ValuesLabel => {
                mysql  => 'MySQL', #loc
                Pg     => 'PostgreSQL', #loc
                Oracle => 'Oracle', #loc
                SQLite => 'SQLite (for experiments and development only)', #loc
            },
        },
    },
    DatabaseHost => {
        Section         => 'Database', #loc
        Widget          => '/Widgets/Form/String',
        WidgetArguments => {
            Description  => 'The domain name of your database server', #loc
        },
    },
    DatabasePort => {
        Section         => 'Database', #loc
        Widget          => '/Widgets/Form/Integer',
        WidgetArguments => {
            Description  => 'Port number database server listen to', #loc
            Default      => 1,
            DefaultLabel => 'Leave empty to use default value of the RDBMS', #loc
        },
    },
    DatabaseName => {
        Section         => 'Database', #loc
        Widget          => '/Widgets/Form/String',
        WidgetArguments => {
            Description => 'Name of the database', #loc
        },
    },
    DatabaseUser => {
        Section         => 'Database', #loc
        Widget          => '/Widgets/Form/String',
        WidgetArguments => {
            Description => 'The name of the user RT will use to connect to the DB', #loc
        },
    },
    DatabasePassword => {
        Section         => 'Database', #loc
        Widget          => '/Widgets/Form/String',
        WidgetArguments => {
            Description => 'Password of the above user RT will use to connect to the DB', #loc
        },
    },
    DatabaseAdmin => {
        Section         => 'Database', #loc
        Widget          => '/Widgets/Form/String',
        WidgetArguments => {
            Description => 'The name of the database admin we will use to create and initialize the DB', #loc
        },
    },
    DatabaseAdminPassword => {
        Section         => 'Database', #loc
        Widget          => '/Widgets/Form/String',
        WidgetArguments => {
            Description => 'Password of the database admin', #loc
        },
    },
);
my %META = @db_options;

my $dump_config = sub {
    my %data = @_;

    my $res = '';

    for ( my $i = 0; $i < @db_options; $i += 2 ) {
        my $option = $db_options[$i];
        next unless exists $data{ $option } && defined $data{ $option };
        my $meta = $db_options[$i+1];
        my $value = $data{ $option };
        $res .= "Set(\$$option, '$value');\n";
    }
    $res .= "\n1;# don't delete this line\n";
    return $res;
};

if ( $ARGS{'DatabaseCreate'} ) {
    my %config = ();
    for ( my $i = 0; $i < @db_options; $i += 2 ) {
        my $option = $db_options[$i];
        my $meta = $db_options[$i+1];
        my $value = $m->comp( $meta->{'Widget'} .':Process',
            Arguments    => \%ARGS,
            Default      => 0,
            %{ $meta->{'WidgetArguments'} },
            Name         => $option,
            CurrentValue => scalar RT->Config->Get( $option ),
        );
        $config{ $option } = $value;
        $config{ $option } = scalar RT->Config->Get( $option )
            if !defined $value && $meta->{'WidgetArguments'}{'Default'};
    }
    warn($dump_config->(%config));
    {
        open my $fh, '>', '/tmp/site-config';
        print $fh $dump_config->(%config);
        close $fh;
    }

    RT->Config->LoadConfig( File => '/tmp/site-config' );
    require RT::Handle;

    my ($dba_user, $dba_pass) = @config{'DatabaseAdmin', 'DatabaseAdminPassword'};

    my $dbh = _get_dbh( RT::Handle->SystemDSN, $dba_user, $dba_pass );
    my ($status, $msg) = RT::Handle->CreateDatabase( $dbh );

    $dbh = _get_dbh( RT::Handle->DSN, $dba_user, $dba_pass );
    ($status, $msg) = RT::Handle->InsertSchema( $dbh );
    ($status, $msg) = RT::Handle->InsertACL( $dbh );

    RT::ConnectToDatabase();
    RT::InitLogging();
    RT::InitSystemObjects();

    ($status, $msg) = $RT::Handle->InsertInitialData;

    $RT::Handle = new RT::Handle;
    RT::Init();

    ($status, $msg) = $RT::Handle->InsertData( $RT::EtcPath . "/initialdata" );
}

sub _get_dbh {
    my ($dsn, $user, $pass) = @_;
    unless ( $user ) {
        my $user = RT->Config->Get('DatabaseUser');
        my $password = RT->Config->Get('DatabasePassword');
    }
    my $dbh = DBI->connect(
        $dsn, $user, $pass,
        { RaiseError => 0, PrintError => 0 },
    );
    unless ( $dbh ) {
        return (undef, "Failed to connect to $dsn as user '$user': ". $DBI::errstr);
    }
    return $dbh;
}
</%INIT>
