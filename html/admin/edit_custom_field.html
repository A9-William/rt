%# BEGIN LICENSE BLOCK
%# 
%#  Copyright (c) 2002 Jesse Vincent <jesse@bestpractical.com>
%#  
%#  This program is free software; you can redistribute it and/or modify
%#  it under the terms of version 2 of the GNU General Public License 
%#  as published by the Free Software Foundation.
%# 
%#  A copy of that license should have arrived with this
%#  software, but in any event can be snarfed from www.gnu.org.
%# 
%#  This program is distributed in the hope that it will be useful,
%#  but WITHOUT ANY WARRANTY; without even the implied warranty of
%#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%#  GNU General Public License for more details.
%# 
%# END LICENSE BLOCK

<& /Elements/Header, Ttite => 'Edit custom field' &>
<& /Elements/NavBar&>

<& /Elements/ShowResults, results => \@results &>

<form action=edit_custom_field.html method=post>
<input type=hidden name=EditCustomField value=<%$cf->Id%>>
<input size=40 maxsize=200 value="<%$cf->Name%>" name="RT::FM::CustomField-<%$cf->Id%>-Name"><BR>
<input size=80 maxsize=200 value="<%$cf->Description%>" name="RT::FM::CustomField-<%$cf->Id%>-Description"><BR>
<& /Elements/CustomFieldTypeSelect, Default=> $cf->Type, Name=>"RT::FM::CustomField-".$cf->Id."-Type" &><BR>


% if ($cf->Type =~/^Select/) {
Possible Values: <BR>
<TABLE>
<TR>
<TD>Delete</TD><TD></TD>
% my $values = $cf->ValuesObj;
% while (my $val = $values->Next) {
<TR><TD><input type=checkbox name="DeleteValue-RT::FM::CustomField-<%$cf->Id%>" value="<%$val->Id%>"></TD>
<TD><%$val->Name%></TD></TR>
%}
<TR><TD>
New value:</TD>
<TD>
<input size=20 name="NewValue-RT::FM::CustomField-<%$cf->Id%>"><BR>
<input size=20 name="NewValue-RT::FM::CustomField-<%$cf->Id%>"><BR>
<input size=20 name="NewValue-RT::FM::CustomField-<%$cf->Id%>"><BR>
</TD></TR></TABLE>



% }


<div align=right>
<input type=submit name="Delete-RT::FM::CustomField-<%$cf->id%>" value=Delete>
</div>
<input type=submit>
</body>
</html>
<%INIT>
my @results = UpdateCustomFields(ARGSRef => \%ARGS);

my $cf = new RT::FM::CustomField($session{'CurrentUser'});
$cf->Load($EditCustomField);

unless ($cf->Id) {
        Abort("Couldn't find the custom field '$EditCustomField'");
}

if ($ARGS{'Delete-RT::FM::CustomField-'.$cf->Id}) {
	$cf->Delete();
	Abort('Custom field deleted');
}

</%INIT>
<%ARGS>
$EditCustomField => undef
</%ARGS>
