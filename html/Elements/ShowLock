% if ($Duration ||($u->id && $u->id == $session{'CurrentUser'}->id)) {
<div class="locked-by-you">
% if(defined $Duration && !$Lock) {
	<&|/l, $ago &>You had this ticket locked for [_1]. It is now unlocked</&>.
% } else {
	<&|/l, $ago &>You have had this ticket locked for [_1]</&>.
% 		if($Unlock) {
			[<a href="<%$RT::WebPath%>/Ticket/Display.html?id=<%$Ticket->id%>&Lock=remove"><&|/l&>Unlock</&></a>]
%		}
% }

</div>
% } else {
<div class="locked">
<&|/l, $u->Name, $ago &>This ticket has been locked by [_1] for [_2]</&>.
</div>
%}
<%INIT>
my $Lock = $Ticket->Locked();
return unless defined $Duration || $Lock;

my $u = RT::User->new($session{'CurrentUser'});
$u->Load($Lock->Content->{'User'}) if $Lock;

my $date = RT::Date->new($session{'CurrentUser'});
my $ago;
if(defined $Duration && !$Lock) {
	$ago = $date->DurationAsString($Duration);
} elsif($Lock) {
	$ago = $date->DurationAsString(time() - $Lock->Content->{'Timestamp'});
} else {
	return;
}
</%INIT>
<%ARGS>
$Ticket
$Duration => undef
$Unlock => 1;
</%ARGS>
