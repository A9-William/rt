<& /Elements/Header &>
<script>
function updateParent(strItem) {
    window.opener.document.getElementById('<%$field%>').value = strItem;
    window.close();
}
</script>
<a href="javascript: window.close();">close window</a>
<br><br>
<div align="center">
<div class="table-wrapper">
<table>
  <caption><%$months[$DisplayedMonth]%> <%$DisplayedYear%></caption>
  <tr>
% foreach my $wday (@weekdays) {
    <th><%$wday%></th>
% }
  </tr>
% foreach my $week (@cal) {
  <tr>
%     foreach my $day (@{$week}) {
    <td>
%         if ($day) {
%             my $datestr = join('-', $DisplayedYear, $DisplayedMonth+1, $day);
      <dt><a href="javascript: updateParent('<%$datestr%>')"><%$day%></a></dt>
%         }
    </td>
%     } #foreach $day
  </tr>
% } # foreach $week
  <tr>
  <td colspan="2"><a href="CalPopup.html?DisplayedMonth=<%$prev_month%>&DisplayedYear=<%$prev_year%>&field=<%$field%>">Previous</a></td>
    <td colspan="3">&nbsp;</td>
    <td colspan="2"><a href="CalPopup.html?DisplayedMonth=<%$next_month%>&DisplayedYear=<%$next_year%>&field=<%$field%>">Next</a></td>
</table>
</div>
</div>

<%init>
use Calendar::Simple;
my @today = localtime(time());

my @weekdays = (loc('Sun'), loc('Mon'), loc('Tue'), loc('Wed'), loc('Thu'), 
		loc('Fri'), loc('Sat'));
my @months = (loc('January'), loc('February'), loc('March'), loc('April'), 
	      loc('May'), loc('June'), loc('July'), loc('August'), 
	      loc('September'), loc('October'), loc('November'), 
              loc('December'));

unless ($DisplayedYear) {
              $DisplayedMonth = $today[4];
              $DisplayedYear = ($today[5] + 1900);
}              

my ($prev_year, $next_year, $prev_month, $next_month);
$prev_month = $next_month = $DisplayedMonth;
$prev_year = $next_year = $DisplayedYear;

$next_month++;
$prev_month--;

if ($DisplayedMonth == 11) {
    $next_year++;
    $next_month = 0;
    } 
elsif ($DisplayedMonth == 0) {
        $prev_month = 11;
        $prev_year--;


    }




my @cal = calendar($DisplayedMonth, $DisplayedYear);

</%init>
<%args>
$field => 'none'
$DisplayedMonth => undef
$DisplayedYear => undef
</%args>
