<& /Elements/ListActions, actions => \@actions &>

<form method="get" action="Templates.html">
<input type="hidden" class="hidden" name="id" value="<% $id %>" />

% unless ( $Templates->Count ) {
<p><i><&|/l&>(No templates)</&></i></p>
% } else {
<table>
<tr>
<th>
<i><&|/l&>(Check box to delete)</&></i>
</th>
<th>
</th>
</tr>
% my $count;
% while ( my $TemplateObj = $Templates->Next ) {
<tr>
<td>
<input type="checkbox" class="checkbox" name="DeleteTemplate-<%$TemplateObj->Id%>" value="1" />
</td>
<td>
<a href="Template.html?Queue=<%$id%>&Template=<%$TemplateObj->id()%>">
<strong><% loc($TemplateObj->Name) %></strong></a>
<br /><% loc($TemplateObj->Description) %>
</td>
</tr>

% }
</table>
% }

<& /Elements/Submit, Label => loc('Delete Template') &>
</form>

<%INIT>
my $QueueObj = RT::Queue->new( $session{'CurrentUser'} );
$QueueObj->Load( $id ) if $id;

my $Templates = RT::Templates->new($session{'CurrentUser'});
if ( $QueueObj->id ) {
    $Templates->LimitToQueue( $id );
}
else {
    $Templates->LimitToGlobal;
}

# Now let callbacks add their extra limits
$m->callback( %ARGS, Templates => $Templates );
$Templates->RedoSearch;

# deal with deleting existing templates
my @actions;
foreach my $key (keys %ARGS) {
    next unless $key =~ /^DeleteTemplate-(\d+)/;

    my $id = $1;
    my $TemplateObj = RT::Template->new( $session{'CurrentUser'} );
    $TemplateObj->Load( $id );
    unless ( $TemplateObj->id ) {
        push @actions, loc("Couldn't load template #[_1]", $id);
        next;
    }

    my ($retval, $msg) = $TemplateObj->Delete;
    if ( $retval ) {
        push @actions, loc("Template deleted");
    }
    else {
        push @actions, $msg;
    }
}
</%INIT>
<%ARGS>
$id => 0
</%ARGS>
