
<& /Elements/Header, Title=>"Update Ticket" &>

<H1> Update ticket <% $Ticket->Id %> (<%$Action%>)</H1>
<FORM ACTION="ProcessUpdate.html" METHOD=POST>

<TABLE>
<TR>
<TD ALIGN=RIGHT>
Subject:
</TD>
<TD> <% $Ticket->Subject %>
</TD>
</TR>
<TR>
<TD ALIGN=RIGHT><a href="EditWatchers.html?id=<%$Ticket->Id()%>">Interested Parties:</a>
</TD>
<TD>
%# TODO:
(Stubbed: You cannot yet set up particular receipients of one email, you can only <a href="EditWatchers.html?id=<%$Ticket->Id()%>">edit the watcher list</a>)
<ul>
<li>	Requestor:<% $Ticket->RequestorsAsString %> <br>
<li>	Cc:<% $Ticket->CcAsString %><br>
<li>	AdminCc: <% $Ticket->AdminCcAsString %> <br>
</ul>
</TD>
</TR>
</TABLE>

Status:
<& /Elements/SelectStatus, Name=>"SetStatus", Default => $Ticket->Status() &> 

Owner:  
<& /Elements/SelectOwner, Name=>"SetOwner", Default => $Ticket->OwnerObj->Id(), Queue => $Ticket->QueueObj &>


Time Worked: 
<input size=4 name="UpdateTimeWorked"> minutes<br>
<hr>
Update Type: <select name="UpdateType">
		<option value="private" <%$CommentDefault%>>Private Comments (NOT SENT, and invisible to watchers)</option>
		<option value="public" <%$PublicCommentDefault%>>Public Comments (NOT SENT, but visible to watchers) <B>CURRENTLY NONEXISTENT</B> </option>
		<option value="response" <%$ResponseDefault%>>Response (SENT TO EXTERNAL WATCHERS)</option>
	</select> <br>

Update Subject: <input name="UpdateSubject" size=60 value="Re: <% $Ticket->Subject %>"> <br>
<& /Elements/MessageBox, Name=>"UpdateContent", QuoteTransaction=>$ARGS{QuoteTransaction}, MessageURI=>$MessageURI &>
<INPUT TYPE=HIDDEN NAME=id VALUE="<%$Ticket->Id%>"><br>
%if ($MessageURI) {
<INPUT TYPE="HIDDEN" NAME="Link" value="LinkTo">
<INPUT TYPE="HIDDEN" NAME="LinkType" value="RefersTo">
<INPUT TYPE="HIDDEN" NAME="LinkTo" value="<%$MessageURI%>">
%}
<INPUT TYPE=SUBMIT VALUE="Comment/Reply/Update">
</FORM>

<%INIT>

## Things needed in the template - we'll do the processing here, just
## for the convinience:

my $Action=$ARGS{DefaultAction} || "Response";
my $PublicCommentDefault=$Action eq "PublicComment" ? "SELECTED" : "";
my $CommentDefault=$Action eq "Comment" ? "SELECTED" : "";
my $ResponseDefault=$Action eq "Respond" ? "SELECTED" : "";
use RT::Ticket;
my $Ticket=RT::Ticket->new($session{'CurrentUser'});
$Ticket->Load($ARGS{'id'});
my $MessageURI;
$MessageURI=$ARGS{MessageLinkPrefix} . $ARGS{MessageLink}
if $ARGS{MessageLink};

</%INIT>
