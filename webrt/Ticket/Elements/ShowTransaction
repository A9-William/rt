 <& /Elements/TitleBoxStart, title => $Transaction->Description,  titleright=> $Transaction->Message->First ? ($RT::WebOptions{ExtraTransactionActions}->(Transaction=>$Transaction) . "[<a class='inverse' href=\"Update.html?id=".$Transaction->Ticket . "&QuoteTransaction=".$Transaction->Id."&Action=Respond\">Reply</a>] [<a class='inverse' href=\"Update.html?id=".$Transaction->Ticket . "&QuoteTransaction=".$Transaction->Id."&Action=Comment\">Comment</a>]</a>") : "" &>


    <TABLE WIDTH="100%">
      <TR>
	<TD VALIGN=TOP WIDTH="20%">
	  <& /Elements/ShadedBox, title => 'Date' , content => $Transaction->CreatedAsString &>
	</TD>
	<TD VALIGN=TOP WIDTH="20%">
	  <& /Elements/ShadedBox, title => 'Id' , content => $Transaction->Id &>
	</TD>
	<TD VALIGN=TOP WIDTH="20%"> 
	  <& /Elements/ShadedBox, title => 'Actor' , content => $Transaction->Creator->Name &>
	</TD>
	<TD VALIGN=TOP WIDTH="20%">
	  <& /Elements/ShadedBox, title => 'Time Worked' , content => $TimeTaken &>
	</TD>
	
	
      </TR>
    </TABLE>

% unless ($Collapsed) {

%# I had to temporarly move this one because the box grew too wide when a message was too wide.


% $attachments->GotoFirstItem;
%  while (my $message=$attachments->Next) {

<TABLE WIDTH="100%">
<TR>
<TD>

<pre>
%if ($FullHeaders) {
<%$message->Headers %>
% } else {
<%$message->NiceHeaders %>
%}
</pre>
</TD>
<TD VALIGN=TOP ALIGN=RIGHT>
%if ($FullHeaders) {
<A HREF="Display.html?id=<%$Transaction->TicketObj->id%>">Brief headers</a>
% } else {
<A HREF="Display.html?ShowHeaders=<%$Transaction->Id%>&id=<%$Transaction->TicketObj->id%>">Full headers</a>
%}



</TD>
</TR>
</TABLE>

%   if ($message->ContentType =~ m{^(text/plain|message)} && length($message->Content)<13456) {
<pre>
%#TODO We're now HTML escaping the message content, but should
%#TODO probably deal with converting links
<% $message->Content %>
</pre>
%    }  
% elsif ($message->ContentType =~ m{^multipart}) {
This is a multipart message
% } else {
	
Attachment: <A HREF="Attachment/<%$Transaction->Id%>/<%$Transaction->TicketObj->id%>/<%$message->Id%>/<%$message->Filename%>"><%$message->Filename%></a>

%  }
% }

% }

<& /Elements/TitleBoxEnd &>


<%ARGS>
$Transaction => undef
$TimeTaken => undef
$FullHeaders => undef
$Collapsed => undef
</%ARGS>

<%INIT>
if ($Transaction->TimeTaken > 0) {
	$TimeTaken = $Transaction->TimeTaken." minutes"
}
my $attachments = $Transaction->Attachments;

</%INIT>
