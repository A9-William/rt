%# $Header$
%# Copyright 1996-2000 Jesse Vincent <jesse@fsck.com>

<& /Elements/Header, Title => "Ticket View (#".$Ticket->Id.($Ticket->Subject&&(", ".$Ticket->Subject)).")" &>

% for (@Actions) {
   <%$_%><br>
% }


<& /Ticket/Elements/TicketToolBox, Ticket => $Ticket&>

<& /Ticket/Elements/ShowSummary,  Ticket => $Ticket &>
<& /Elements/TitleBoxEnd &>

<h1>Ticket History</h1>

<& /Ticket/Elements/ShowHistory , Ticket => $Ticket &> 

<& /Elements/TitleBoxEnd &>


%# TODO: Evaluate if this should be in RT 2.0 or not, eventually move
%# it to a separate module.
%if ($ARGS{'ShowMembers'}) {

%# Popular demand; to save time, it should be possible to request
%# the history of _all_ the submembers through one mouse click

%while (my $l=$Ticket->Children->Next) {
%if ($l->BaseIsLocal) {
%# TODO: Make a concentrated "ShowShortSummary"
<h1>Ticket History for <%$l->BaseObj->Subject%></h1>
<& /Ticket/Elements/ShowHistory, Ticket => $l->BaseObj &>
%}
%}

%}


<%ARGS>
$id => undef
</%ARGS>

<%INIT>

&Error('No ticket specified') unless $id;

use RT::Ticket;
use RT::CurrentUser;
use RT::Interface::Web;

my @Actions;

my $Ticket = &CreateOrLoad(CurrentUser => $session{'CurrentUser'},
			   id=>$id, 
			   ARGS=>\%ARGS, 
			   Actions=>\@Actions);
$id=$Ticket->Id;

# Eventually, link up the ticket:

&LinkUpIfRequested(ARGS=>\%ARGS, Actions=>\@Actions, Ticket=>$Ticket);


# Eventually, update the told, take, steal, kill the ticket:

&ProcessSimpleActions(ARGS=>\%ARGS, Actions=>\@Actions, Ticket=>$Ticket);

</%INIT>




