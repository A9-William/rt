%# $Header$
%# Copyright 1996-2000 Jesse Vincent <jesse@fsck.com>

<& /Elements/Header, Title => "Ticket View (#".$Ticket->Id.($Ticket->Subject&&(", ".$Ticket->Subject)).")" &>

% for (@Actions) {
   <%$_%><br>
% }


<& /Ticket/Elements/TicketToolBox, Ticket => $Ticket&>

<& /Ticket/Elements/ShowSummary,  Ticket => $Ticket &>
<& /Elements/TitleBoxEnd &>
<h1>Ticket History</h1>

<& /Ticket/Elements/ShowHistory , Ticket => $Ticket, ShowHeaders => $ARGS{'ShowHeaders'} &> 

<& /Elements/TitleBoxEnd &>



<%ARGS>
$id => undef
$Create => undef
</%ARGS>

<%INIT>

&Error('No ticket specified') unless $id;

use RT::Ticket;
use RT::CurrentUser;
use RT::Interface::Web;

my @Actions;

#Here, tobias passes in an empty array so we can get the returns out.
my $Ticket = &CreateOrLoad(CurrentUser => $session{'CurrentUser'},
			   id=>$id, 
			   ARGS=>\%ARGS, 
			   Actions=>\@Actions);

my ($linkid, $message, $tid);
if ($ARGS{'DependsOn'}){
  ($linkid, $message, $tid) = $Ticket->LinkTo( Target => $ARGS{'DependsOn'}, Type => 'DependsOn');
  push @Actions, $message;
}

if ($ARGS{'DependedOnBy'}){
  ($linkid, $message, $tid) = $Ticket->LinkFrom( Base => $ARGS{'DependedOnBy'}, Type => 'DependsOn');
  push @Actions, $message;
}


if ($ARGS{'MemberOf'}){
  ($linkid, $message, $tid) = $Ticket->LinkTo( Target => $ARGS{'MemberOf'}, Type => 'MemberOf');
  push @Actions, $message;
}


$id=$Ticket->Id;

# Eventually, link up the ticket:

&LinkUpIfRequested(ARGS=>\%ARGS, Actions=>\@Actions, Ticket=>$Ticket);


# Eventually, update the told, take, steal, kill the ticket:

&ProcessSimpleActions(ARGS=>\%ARGS, Actions=>\@Actions, Ticket=>$Ticket);

</%INIT>




