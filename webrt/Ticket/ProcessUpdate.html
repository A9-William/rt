<& /Elements/Header, Title => "Ticket #".$Ticket->Id." Updated" &>

<h1>Ticket Updates:</h1>
% for (@Actions) {
   <%$_%><br>
% }

<& /Ticket/Elements/TicketToolBox, Ticket => $Ticket&>
<& /Ticket/Elements/ShowSummary,  Ticket => $Ticket &>
<& /Elements/TitleBoxEnd &>
<h1>Ticket History</h1>
<& /Ticket/Elements/ShowHistory , Ticket => $Ticket &> 
<& /Elements/TitleBoxEnd &>

<%init>

my @Actions;

use RT::Ticket;
use RT::CurrentUser;
use MIME::Entity;
use RT::Interface::Web;

my $Ticket = LoadTicket($ARGS{id}, $session{'CurrentUser'});

# This should be done first, so the new owner gets all information
ProcessOwnerChangeRequest(ARGS=>\%ARGS, Ticket=>$Ticket, Actions=>\@Actions);

ProcessUpdateMessage(ARGS=>\%ARGS, Ticket=>$Ticket, Actions=>\@Actions);

my $Transaction;
my $Description;

if ($ARGS{'Take'}) {
    ## TODO: Remove this temporary debugline:
    warn "This code shouldn't be here; called from: ".$ENV{HTTP_REFERER};
    ($Transaction, $Description)=$Ticket->Take();
    push(@Actions, $Description);
}

# Eventually, link up the ticket
&LinkUpIfRequested(ARGS=>\%ARGS, Ticket=>$Ticket, Actions=>\@Actions);




</%init>




