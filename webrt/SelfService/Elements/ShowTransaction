 <& /Elements/TitleBoxStart, title => $Transaction->Description &>


    <TABLE WIDTH="100%">
      <TR>
	<TD VALIGN=TOP WIDTH="20%">
	  <& /Elements/ShadedBox, title => 'Date' , content => $Transaction->CreatedAsString &>
	</TD>
	<TD VALIGN=TOP WIDTH="20%"> 
	  <& /Elements/ShadedBox, title => 'Actor' , content => $Transaction->Creator->UserId &>
	</TD>
	<TD VALIGN=TOP WIDTH="20%">
	  <& /Elements/ShadedBox, title => 'Time Worked' , content => $TimeTaken &>
	</TD>
	
	
      </TR>
    </TABLE>

%# I had to temporarly move this one because the box grew too wide when a message was too wide.


% $attachments->GotoFirstItem;
%  while (my $message=$attachments->Next) {

<TABLE WIDTH="100%">
<TR>
<TD>

<pre>
<%$message->NiceHeaders %>
</pre>
</TD>
<TD VALIGN=TOP ALIGN=RIGHT>

</TD>
</TR>
</TABLE>

%   if ($message->ContentType =~ m{^(text/plain|message)} && length($message->Content)<13456) {
<pre>
%#TODO We're now HTML escaping the message content, but should
%#TODO probably deal with converting links
<% $message->Content %>
</pre>
%    }  
% elsif ($message->ContentType =~ m{^multipart}) {
This is a multipart message
% } else {
	
Attachment: <A HREF="Attachment/<%$Transaction->Id%>/<%$Transaction->TicketObj->id%>/<%$message->Id%>/<%$message->Filename%>"><%$message->Filename%></a>

%  }
% }
<& /Elements/TitleBoxEnd &>


<%ARGS>
$Transaction => undef
$TimeTaken => undef
$FullHeaders => undef
</%ARGS>

<%INIT>
if ($Transaction->TimeTaken > 0) {
	$TimeTaken = $Transaction->TimeTaken." minutes"
}
my $attachments = $Transaction->Attachments;

</%INIT>
