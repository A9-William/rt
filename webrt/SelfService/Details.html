<& /Elements/Header, Title => 'Display ticket #'.$Ticket->id &>
<& Elements/Tabs &>


<& /Elements/ListActions, actions => \@results &>

<TABLE>
    <TR>
	<TD VALIGN=TOP WIDTH="20%" ALIGN=RIGHT>
	Ticket Id
	</TD>
      <TD>
	<%$Ticket->Id%>
% if ($Ticket->Alias) {
	(<%$Ticket->Alias%>)
% }

	</TD>
      </TR>
    <TR>	
      <TD VALIGN=TOP WIDTH="20%" ALIGN=RIGHT>
	Requestors
	</TD>
      <TD>
	<%$Ticket->RequestorsAsString%>
      </TD>
      </TR>
    <TR>	
      <TD VALIGN=TOP WIDTH="20%" ALIGN=RIGHT>
	Cc
	</TD>
      <TD>
	<%$Ticket->CcAsString%>
      </TD>
    </TR>

  <TR>	
      <TD VALIGN=TOP WIDTH="20%" ALIGN=RIGHT>
	Status
	</TD>
      <TD>
	<%$Ticket->Status%>
      </TD>
    </TR>

    <TR>	
      <TD VALIGN=TOP WIDTH="20%" ALIGN=RIGHT>
	Queue
	</TD>
      <TD>
	<%$Ticket->QueueObj->QueueId%> (<%$Ticket->QueueObj->Description%>)
      </TD>
    </TR>
    <TR>	
      <TD VALIGN=TOP WIDTH="20%" ALIGN=RIGHT>
	Priority
      </TD>
      <TD>
	<%$Ticket->Priority %>
      </TD>
    </TR>
 
%  if ($Ticket->TimeWorked) {
   <TR>	
      <TD VALIGN=TOP WIDTH="20%" ALIGN=RIGHT>
	Worked
      </TD>
      <TD>
	<%$Ticket->TimeWorked %> minutes
      </TD>
    </TR>
% }
    
% my $selects = $Ticket->QueueObj->KeywordSelects;
% while (my $select = $selects->Next) {
    <TR>
      <TD VALIGN=TOP WIDTH="20%" ALIGN=RIGHT>
	<%$select->Name%>
      </TD>
      <TD>
% my $object_keywords = $Ticket->KeywordsObj($select->id);	
% while (my $keyword = $object_keywords->Next) {
	<%$keyword->KeywordObj->RelativePath($select->KeywordObj)%>
% }
%}
	</TD>
      </TR>




	</TABLE>
%while (my $Transaction = $Transactions->Next) {

%	if ($Transactions->IsLast) {
	<a name="lasttrans">
% 	}
	<& Elements/ShowTransaction, Transaction => $Transaction&>

<BR>
%}



<%INIT>

my $field;
my @results;

# {{{ Load the ticket
#If we get handed two ids, mason will make them an array. bleck.
# We want teh first one. Just because there's no other sensible way
# to deal
my @id = (ref $id eq 'ARRAY') ? @{$id} : ($id);                

my $Ticket = new RT::Ticket($session{'CurrentUser'});
$Ticket->Load($id[0]) || $m->comp('/Elements/Error', Why => "Couldn't load ticket '$id'");
# }}}


my ($code, $msg);

#Update the status
if ((defined $ARGS{'Status'}) and 
    ($ARGS{'Status'} ne $Ticket->Status)) {
    ($code, $msg) = $Ticket->SetStatus($ARGS{'Status'});
    push @results, "$msg";
}

my $Transactions = $Ticket->Transactions;

</%INIT>


<%ARGS>
$id => undef
</%ARGS>
