<HTML>
<HEAD>
</HEAD>
<BODY BGCOLOR="#FFFFFF">
<H1>WebRT Queue</H1>


%#<& QueueInterpretRestrictionCookies &>
<TABLE WIDTH=100%>
%#<& QueueHeader format="$format" &>
%while (my $Ticket = $Tickets->Next) {
<TR>
	<TD>
	<& QueueItem , Ticket=>$Ticket &>
	</TD>
</TR>
%}
</TABLE>
%#<& QueueFooter format="$format" &>

<HR>

<& PickRestriction, CurrentUser => $CurrentUser &>
  

<%INIT>

use RT::Tickets;
use RT::CurrentUser;

print STDERR "Kilroy was here\n";

my $CurrentUser = RT::CurrentUser->new(2);
my $Tickets = RT::Tickets->new($CurrentUser);


if ($ARGS{'LimitOwner'}) {
  my $oper;
  if ($ARGS{'NegateOwner'}==1) {
    $oper = "!=";
  }
  else {
    $oper = "=";
  }
  
  $Tickets->Limit (FIELD => 'Owner',
		   VALUE => $ARGS{'ValueOfOwner'},
		   OPERATOR => "$oper"
		  )
}


if (0) {
# TODO: this code requires some creative use of EasySearch that I'm not up to 
# right now
#if ($ARGS{'LimitRequestor'}) {
  my $oper;
  if ($ARGS{'NegateRequestor'}==1) {
  
    $oper = "NOT LIKE";
  }
  else {
    $oper = "LIKE";
  }
  
  $Tickets->Limit (FIELD => 'Requestors',
		   VALUE => $ARGS{'ValueOfRequestors'},
		   OPERATOR => "$oper"
		  )
}


if ($ARGS{'LimitSubject'}) {
 my $oper; 
  if ($ARGS{'NegateSubject'}==1) {
    $oper = "NOT LIKE";
  }
  else {
    $oper = "LIKE";
  }
  
  $Tickets->Limit (FIELD => 'Subject',
		   VALUE => $ARGS{'ValueOfSubject'},
		   OPERATOR => "$oper"
		  )
}



if ($ARGS{'LimitQueue'}) {
  my $oper;
  if ($ARGS{'NegateQueue'}==1) {
    $oper = "!=";
  }
  else {
    $oper = "=";
  }
  
  $Tickets->Limit (FIELD => 'Queue',
		   VALUE => $ARGS{'ValueOfQueue'},
		   OPERATOR => "$oper"
		  )
}

if ($ARGS{'LimitStatus'}) {
  my $oper;
  if ($ARGS{'NegateStatus'}==1) {
    $oper = "!=";
  }
  else {
    $oper = "=";
  }
  
  $Tickets->Limit (FIELD => 'Status',
		   VALUE => $ARGS{'ValueOfStatus'},
		   OPERATOR => "$oper"
		  )
}

# $Tickets->Limit( FIELD => 'status',
#			VALUE => "open");
</%INIT>
