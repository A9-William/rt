%# $Header$
%# Copyright 1996-2000 Jesse Vincent <jesse@fsck.com>

<& /Elements/Header, Title => "Ticket Listing / Queue View" &>
<h1>Search limits</h1>
%my %restrictions =$session{'tickets'}->DescribeRestrictions();
%foreach $row (keys %restrictions){
<%$row%>: <%$restrictions{"$row"}%> <A HREF="/Search/Listing.html?DeleteRestriction=<%$row%>">[delete]</a><br>
%}
<BR>
<A HREF="/Search/Listing.html?ClearRestrictions=1">Clear all restrictions</a>
%#<& QueueInterpretRestrictionCookies &>
<TABLE WIDTH=100% border=0 cellpadding=3 CELLSPACING=1>
%#<& QueueHeader format="$format" &>
<TR>
%foreach (@{Config(\%ARGS, 'QueueListingCols')}) {
   <TH><% $_->{Header} %></TH>
%}
</TR>

<%PERL>

while (my $Ticket = $session{'tickets'}->Next) {
 $cnt++; 
 if (($cnt % 2) == 1) {
	$bgcolor = "#cccccc";
 }
 else {
 	$bgcolor = "#ffffff";
 }
</%PERL>
<TR bgcolor="<%$bgcolor%>" >
%# The ticket view is controlled by config.pm, WebOptions
%foreach (@{Config(\%ARGS, 'QueueListingCols')}) {
<TD><& TicketCell , Ticket=>$Ticket,  Column=>$_ &></TD>
%}
</TR>
%}



</TABLE>
%#<& QueueFooter format="$format" &>

<HR>

<& PickRestriction &>


<%INIT>
my $cnt = 0;
my $bgcolor;

require RT::Interface::Web;

$session{'i'}++;
if ($ARGS{'ClearRestrictions'}) {
  $session{'tickets'}->ClearRestrictions;
}

if ($ARGS{'DeleteRestriction'}) {
 $session{'tickets'}->DeleteRestriction($ARGS{'DeleteRestriction'});
}

&ProcessSearchQuery(ARGS=>\%ARGS);

my $row;

</%INIT>
