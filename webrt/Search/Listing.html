<HTML>
<HEAD>
</HEAD>
<BODY BGCOLOR="#FFFFFF">
<H1>WebRT Queue</H1>


%#<& QueueInterpretRestrictionCookies &>
<TABLE WIDTH=100%>
%#<& QueueHeader format="$format" &>
<TR>
%foreach (@{_cfg(\%ARGS, 'QueueListingCols')}) {
   <TH><% $_->{Header} %>
%}

%while (my $Ticket = $Tickets->Next) {
<TR>
%foreach (@{_cfg(\%ARGS, 'QueueListingCols')}) {
	<TD>
	<& TicketCell , Ticket=>$Ticket,  Column=>$_ &>
	</TD>
%}
</TR>
%}
</TABLE>
%#<& QueueFooter format="$format" &>

<HR>

<& PickRestriction &>

<%INIT>

use RT::Tickets;
my $Tickets = RT::Tickets->new($RT::CurrentUser);
if ($ARGS{'LimitResultsPerPage'} and ($ARGS{'ValueOfResultsPerPage'}>0)) {

  $Tickets->Limit (ROWS => $ARGS{'ValueOfResultsPerPage'}
		  )
}

if ($ARGS{'LimitOwner'} and $ARGS{'ValueOfOwner'}) {
  my $oper = $ARGS{'NegateOwner'} ? "!=" : "=";
  $Tickets->Limit (FIELD => 'Owner',
		   VALUE => $ARGS{'ValueOfOwner'},
		   OPERATOR => "$oper"
		  )
}


if (0) {
# TODO: this code requires some creative use of EasySearch that I'm not up to 
# right now
#if ($ARGS{'LimitRequestor'}) {
  my $oper = $ARGS{'NegateRequestor'} ? "!=" : "="; 
  $Tickets->Limit (FIELD => 'Requestors',
		   VALUE => $ARGS{'ValueOfRequestors'},
		   OPERATOR => "$oper"
		  )
}


if ($ARGS{'LimitSubject'}) {
 my $oper = $ARGS{'NegateSubject'} ? "!=" : "="; 
  $Tickets->Limit (FIELD => 'Subject',
		   VALUE => $ARGS{'ValueOfSubject'},
		   OPERATOR => "$oper"
		  )
}


if ($ARGS{'LimitQueue'}) {
  my $oper = $ARGS{'NegateQueue'} ? "!=" : "="; 
  $Tickets->Limit (FIELD => 'Queue',
		   VALUE => $ARGS{'ValueOfQueue'},
		   OPERATOR => "$oper"
		  )
}


if ($ARGS{'LimitStatus'}) {
  my $oper = $ARGS{'NegateStatus'} ? "!=" : "="; 
  $Tickets->Limit (FIELD => 'Status',
		   VALUE => $ARGS{'ValueOfStatus'},
		   OPERATOR => "$oper"
		  )
}




# TODO: This one should _not_ be here, rather somewhere else
# (suggestions?).  It might eventually read the cookies, user
# configuration information from the DB, queue configuration information
# from the DB, etc.  It should be object oriented.  But what object can
# it belong to, and how should it get access to all this data?

sub _cfg {
  my $args=shift;
  my $key=shift;
  return $args->{$key} || $RT::SitePolicy{$key};
}


</%INIT>
