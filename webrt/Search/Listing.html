<HTML>
<HEAD>
</HEAD>
<BODY BGCOLOR="#FFFFFF">
<H1>WebRT Queue</H1>


%#<& QueueInterpretRestrtictionCookies &>
<TABLE WIDTH=100%>
%#<& QueueHeader format="$format" &>
%while (my $Ticket = $Tickets->Next) {
<TR>
	<TD>
	<& QueueItem , Ticket=>$Ticket &>
	</TD>
</TR>
%}
</TABLE>
%#<& QueueFooter format="$format" &>

<HR>

%#<& QueueAddRestriction &>


<%INIT>
use RT::CurrentUser;
my $CurrentUser = RT::CurrentUser->new(2);
my $Tickets = RT::Tickets->new($CurrentUser);
use RT::Tickets;

if ($ARGS{'LimitOwner'}) {
  
  if ($ARGS{'NegateOwner'}=1) {
    my $oper = "!=";
  }
  else {
    my $oper = "=";
  }
  
  $Tickets->Limit (FIELD => 'Owner',
		   VALUE => $ARGS{'ValueOfOwner'}
		   OPERATOR => "$Oper"
		  )
}


if (0) {
# TODO: this code requires some creative use of EasySearch that I'm not up to 
# right now
#if ($ARGS{'LimitRequestor'}) {
  
  if ($ARGS{'NegateRequestor'}=1) {
    my $oper = "NOT LIKE";
  }
  else {
    my $oper = "LIKE";
  }
  
  $Tickets->Limit (FIELD => 'Requestors',
		   VALUE => $ARGS{'ValueOfRequestors'}
		   OPERATOR => "$Oper"
		  )
}


if ($ARGS{'LimitSubject'}) {
  
  if ($ARGS{'NegateSubject'}=1) {
    my $oper = "NOT LIKE";
  }
  else {
    my $oper = "LIKE";
  }
  
  $Tickets->Limit (FIELD => 'Subject',
		   VALUE => $ARGS{'ValueOfSubject'}
		   OPERATOR => "$Oper"
		  )
}



if ($ARGS{'LimitQueue'}) {
  
  if ($ARGS{'NegateQueue'}=1) {
    my $oper = "!=";
  }
  else {
    my $oper = "=";
  }
  
  $Tickets->Limit (FIELD => 'Queue',
		   VALUE => $ARGS{'ValueOfQueue'}
		   OPERATOR => "$Oper"
		  )
}

if ($ARGS{'LimitQueue'}) {
  
  if ($ARGS{'NegateQueue'}=1) {
    my $oper = "!=";
  }
  else {
    my $oper = "=";
  }
  
  $Tickets->Limit (FIELD => 'Queue',
		   VALUE => $ARGS{'ValueOfQueue'}
		   OPERATOR => "$Oper"
		  )
}
if ($ARGS{'LimitStatus'}) {
  
  if ($ARGS{'NegateStatus'}=1) {
    my $oper = "!=";
  }
  else {
    my $oper = "=";
  }
  
  $Tickets->Limit (FIELD => 'Status',
		   VALUE => $ARGS{'ValueOfStatus'}
		   OPERATOR => "$Oper"
		  )
}

 $Tickets->Limit( FIELD => 'status',
			VALUE => "open");
</%INIT>
