%# $Header$
%# Copyright 1996-2000 Jesse Vincent <jesse@fsck.com>
<& /Elements/Header, Title => "Search" &>
<& /Elements/Tabs &>

<H1><Tickets</H1>

<TABLE WIDTH=100% border=0 cellpadding=3 CELLSPACING=1>
<TR>
%foreach (@{Config(\%ARGS, 'QueueListingCols')}) {
   <TH><% $_->{Header} %></TH>
%}
</TR>

<%PERL>

while (my $Ticket = $session{'tickets'}->Next) {
 $cnt++; 
 if (($cnt % 2) == 1) {
	$bgcolor = "#dddddd";
 }
 else {
 	$bgcolor = "#ffffff";
 }
</%PERL>
<TR bgcolor="<%$bgcolor%>" >
%# The ticket view is controlled by config.pm, WebOptions
%foreach (@{Config(\%ARGS, 'QueueListingCols')}) {
<TD><& TicketCell , Ticket=>$Ticket,  Column=>$_ &></TD>
%}
</TR>
%}



</TABLE>
%#<& QueueFooter format="$format" &>

<HR>
<TABLE WIDTH="100%">
<TR>
<TD VALIGN="TOP">
<& /Elements/TitleBoxStart, title => 'Search Criteria'&>

<A HREF="<% $RT::WebPath%>/Search/Listing.html?ClearRestrictions=1">New search</a>
<BR>
<BR>
%my %restrictions=$session{'tickets'}->DescribeRestrictions();
%foreach $row (keys %restrictions){
<%$restrictions{"$row"}%> <A HREF="<% $RT::WebPath %>/Search/Listing.html?DeleteRestriction=<%$row%>">[delete]</a><br>
%}
<& /Elements/TitleBoxEnd&>
</TD>
<TD>
<& /Elements/TitleBoxStart, title => 'Restrict Search'&>
<& PickRestriction &>
<& /Elements/TitleBoxEnd &>
</TD>
</TR>
</TABLE>

<%INIT>
my $cnt = 0;
my $bgcolor;

require RT::Interface::Web;

$session{'i'}++;
if ($session{'tickets'}) {
    if ( ($ARGS{'ClearRestrictions'}) ||
	 ($ARGS{'NewSearch'}) ) {
	$session{'tickets'}->ClearRestrictions;
    }
    
    if ($ARGS{'DeleteRestriction'}) {
	$session{'tickets'}->DeleteRestriction($ARGS{'DeleteRestriction'});
    }
}
&ProcessSearchQuery(ARGS=>\%ARGS);

my $row;

</%INIT>
