<FORM METHOD=POST>
<INPUT TYPE=HIDDEN NAME=Queue VALUE="<%$QueueObj->id%>">

<TABLE>
<%PERL>
#Iterate through all users with rights in this queu
while (my $UserObj = $Users->Next()) {
my $UserACLObj = new RT::ACL($session{'CurrentUser'});

$UserACLObj->LimitScopeToQueue($QueueObj->Id);
$UserACLObj->LimitPrincipalToUser($UserObj->Id);
$UserACLObj->_BuildHash();
</%PERL>
<TR>
<TD>
<%$UserObj->UserId%>
</TD>
<TD>
<SELECT SIZE=5  MULTIPLE NAME="ACL-User-<%$UserObj->Id%>-<%$QueueObj->Id%>">
%foreach $right (keys %TicketRights) {
<OPTION VALUE="Ticket-<%$right%>"
<%  $UserACLObj->HasEntry(PrincipalId => $UserObj->Id ,
               PrincipalType => 'User',
               RightName => $right, 
               RightScope => 'Ticket', 
               RightAppliesTo => $QueueObj->Id) && 'SELECTED' %>
>Ticket:<%$right%></OPTION>
%}
%foreach $right (keys %QueueRights) {
<OPTION VALUE="Queue-<%$right%>"
<%  $UserACLObj->HasEntry(PrincipalId=> $UserObj->Id , 
              PrincipalType => 'User', 
              RightName => $right, 
              RightScope => 'Queue', 
              RightAppliesTo => $QueueObj->Id) && 'SELECTED'  %>
>Queue:<%$right%></OPTION>
%}
</SELECT>
</TD>
</TR>

% }
</TABLE>

<TABLE>

%#Iterate through all users with rights in this queu
%while (my $GroupObj = $Groups->Next()) {
<TR>
<TD>
<%$GroupObj->GroupId%>
</TD>
<TD>
<SELECT SIZE=5  MULTIPLE NAME="ACL-Group-<%$GroupObj->Id%>-<%$QueueObj->Id%>">
%foreach $right (keys %TicketRights) {
<OPTION VALUE="Ticket-<%$right%>">Ticket:<%$right%></OPTION>
%}
%foreach $right (keys %QueueRights) {
<OPTION VALUE="Queue-<%$right%>">Queue:<%$right%></OPTION>
%}
</SELECT>
</TD>
</TR>

% }
</TABLE>
<INPUT TYPE=SUBMIT>
</FORM>
<%INIT>

if (!defined $Queue) {
        &FatalError("No Queue defined");
}
my $QueueObj = new RT::Queue($session{'CurrentUser'});
$QueueObj->Load($Queue) ||
        &FatalError("Couldn't load queue $Queue");

#Create an RT::Users object which contains all users
my $Users = new RT::Users($session{'CurrentUser'});
$Users->LimitToPrivileged();
#$Users->UnLimit();


#Get an RT::Groups object to list the ACLs for
my $Groups = new RT::Groups($session{'CurrentUser'});
$Users->UnLimit();


my $AdminCcRights = new RT::ACL($session{'CurrentUser'});
$AdminCcRights->LimitScopeToQueue($QueueObj->id);
$AdminCcRights->LimitPrincipalToType('AdminCc');

my $CcRights = new RT::ACL($session{'CurrentUser'});
$CcRights->LimitScopeToQueue($QueueObj->id);
$CcRights->LimitPrincipalToType('Cc');

my $RequestorRights = new RT::ACL($session{'CurrentUser'});
$RequestorRights->LimitScopeToQueue($QueueObj->id);
$RequestorRights->LimitPrincipalToType('Requestor');

my ($right);
my %TicketRights = RT::ACE->TicketRights;
my %QueueRights = RT::ACE->QueueRights;
</%INIT>

<%ARGS>
$Queue = undef
$UserString => undef
$UserOp => undef
$UserField => undef
</%ARGS>
