<& /Admin/Elements/Header, Title => "RT/Admin/Edit the group ". $Group->Name &>
<& /Admin/Elements/GroupTabs, id => $Group->id &>
<& /Elements/ListActions, actions => \@results &>


<& /Elements/TitleBoxStart, title => 'Editing membership for group '.$Group->Name &>

<FORM ACTION="<%$RT::WebPath%>/Admin/Groups/Members.html" METHOD=POST>
<INPUT TYPE=HIDDEN NAME=id VALUE="<%$Group->Id%>">
<TABLE WIDTH="100%">
<TR>
<TD>
Add members
</TD>
<TD>
Current members
</TD>
</TR>

<TR>
<TD VALIGN=TOP>
<& /Admin/Elements/SelectUsers, Name => "AddMembers" &>
</TD>
<TD VALIGN=TOP>

(Check box to delete group member)
<UL>
% while (my $member = $Group->MembersObj->Next()) {
<LI><INPUT TYPE=CHECKBOX Name="DeleteMember-<%$member->id%>">
<%$member->UserObj->UserId%> (<%$member->UserObj->RealName%>)
% }
</UL>
</TD>
</TR>
</TABLE>
<& /Elements/Submit &>
</form>
<& /Elements/TitleBoxEnd &>


<%INIT>
my $Group = new RT::Group($session{'CurrentUser'});

if ($id) {
    $Group->Load($id) || Abort('Could not load group');
}
elsif ($CreateGroup) {
    $Group->Create(Name => "$Name");
}
else {
    Abort("You didn't specify a valid action");
}


my $key;
foreach $key (keys %ARGS) {

if ($key =~ /^DeleteMember-(\d+)$/) {
    my $id = $1; 
    my $retval = $Group->DeleteMember($id);
    push (@results, $retval);
}
if ($key =~ /^AddMembers$/) {
    my $retval = $Group->AddMember($ARGS{"$key"});
    push (@results, $retval);
}
}

</%INIT>

<%ARGS>
@results => undef
$CreateGroup => undef
$Name => undef
$id => undef
</%ARGS>
