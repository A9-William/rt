<& /Elements/Header, Title=>"Preferences" &>

%if ($session{CurrentUser} && ($session{CurrentUser}->Id == $id)) {
	<& /Elements/TitleBoxStart, title => 'Signature'  &>
<form method=post>
<input type="hidden" name="id" value=<%$id%>>
<TEXTAREA COLS=72 ROWS=4 WRAP=HARD NAME="Signature"><% $u->Signature %></TEXTAREA><br><br>
	  <& /Elements/TitleBoxEnd &>
      <input type="checkbox" name="NewWindowOption" <%exists $session{NewWindowOption} && "CHECKED"%>>
	  Open tickets (from listing) in seperate window<BR>
      <input type="checkbox" name="AlwaysNewWindowOption" <%exists $session{AlwaysNewWindowOption} && "CHECKED"%>>
	  Display each ticket in its own window
      <& /Elements/Submit &>
	  </form>

%}
<%ARGS>
$id => $session{CurrentUser} ? $session{CurrentUser}->Id : 0
$Signature => undef
</%ARGS>

<%INIT>
my $u=RT::User->new($session{CurrentUser});
$u->Load($id) || die "Couldn't load that user ($id)";
if ($Signature) {
my ($val, $msg)=$u->SetSignature($Signature);
$RT::Logger->log(level=>($val ? 'info' : 'error'), message=>$msg);
}


if ($ARGS{NewWindowSetting}) {
if ($ARGS{NewWindowOption}) {
$session{NewWindowOption}=1;
} else {
delete $session{NewWindowOption};
}
if ($ARGS{AlwaysNewWindowOption}) {
$session{NewWindowOption}=1;
$session{AlwaysNewWindowOption}=1;
} else {
delete $session{AlwaysNewWindowOption};
}
}

</%INIT>









