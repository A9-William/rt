#!/usr/bin/perl -w
use strict;
use warnings;

use lib 'lib';
use RT;
RT::LoadConfig();
RT::Init();

use RT::Serializer;
my $walker = RT::Serializer->new();

my $attributes = RT::System->new( RT->SystemUser )->Attributes;

my $actions = RT::ScripActions->new( RT->SystemUser );
$actions->UnLimit;

my $conditions = RT::ScripConditions->new( RT->SystemUser );
$conditions->UnLimit;

my $users = RT::Users->new( RT->SystemUser );
$users->LimitToPrivileged;

my $groups = RT::Groups->new( RT->SystemUser );
$groups->LimitToUserDefinedGroups;

my $classes = RT::Classes->new( RT->SystemUser );
$classes->UnLimit;

my $queues = RT::Queues->new( RT->SystemUser );
$queues->UnLimit;

$walker->PushObj(
    $attributes,
    $actions, $conditions,
    $users, $groups,
    $classes, $queues,
);

my %counts = $walker->Walk;

print "Total object counts:\n";
for (sort {$counts{$b} <=> $counts{$a}} keys %counts) {
    printf "%8d %s\n", $counts{$_}, $_;
}
