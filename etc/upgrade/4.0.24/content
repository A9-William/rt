use strict;
use warnings;
our @Initial = (
   sub {
       if ( RT->Config->Get('DatabaseType') eq 'Oracle' ) {
           my $dbh = RT->DatabaseHandle->dbh;
           my $rows = $dbh->selectall_arrayref('SELECT id FROM Articles WHERE rownum = 1 ORDER BY id DESC');

           if ( @$rows ) {
               my $last_id = $rows->[0][0];
               my $next_value = $dbh->selectall_arrayref('SELECT Articles_seq.nextval FROM DUAL')->[0][0];
               return if $last_id == $next_value; # next seq value will be correct
               if ( $last_id > $next_value ) {
                   while ( $last_id > $next_value ) {
                       $next_value = $dbh->selectall_arrayref('SELECT Articles_seq.nextval FROM DUAL')->[0][0];
                   }
               }
               else {
                   # everything was fine, get back to the original seq value
                   $dbh->do('ALTER SEQUENCE Articles_seq INCREMENT BY -1');
                   # ->do doesn't really work here, Oracle--
                   $dbh->selectall_arrayref('SELECT Articles_seq.nextval FROM DUAL');
                   $dbh->do('ALTER SEQUENCE Articles_seq INCREMENT BY 1'),
               }
           }
       }
   },
);
