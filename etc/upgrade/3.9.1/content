@Initial = (
    sub {
        use strict;
        $RT::Logger->debug('Make sure templates all have known types');

        my $templates = RT::Templates->new($RT::SystemUser);
        $templates->Limit(
            FIELD => 'Type',
            OPERATOR => '!=',
            VALUE => 'Action',
        );

        if ($templates->Count) {
            die "You have templates with Type other than Action. This will interfere with your upgrade because RT used to ignore the template Type field, but now uses it.";
        }

        $templates->UnLimit();
        while (my $template = $templates->Next) {
            my ($status, $msg) = $template->SetType('Full');
            unless ( $status ) {
                die "Couldn't change Type of Template #" . $template->Id . ": $msg";
            }
        }
    },
);

