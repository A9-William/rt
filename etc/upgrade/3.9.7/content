my $move_attributes = sub {
    my ($table, $type, $column) = @_;
    my $query = "UPDATE $table SET $column = (SELECT Content FROM Attributes WHERE"
        ." Name = ? AND ObjectType = ? AND $table.id = Attributes.ObjectId)";

    my $res = $RT::Handle->SimpleQuery( $query, $column, $type );
    unless ( $res ) {
        $RT::Logger->error("Failed move $type from Attributes into $table table");
        return;
    }

    $query = 'DELETE FROM Attributes WHERE Name = ? AND ObjectType = ?';
    $res = $RT::Handle->SimpleQuery( $query, $column, $type );
    unless ( $res ) {
        $RT::Logger->error("Failed to delete AuthTokens Attributes");
        return;
    }
    return 1;
};

@Initial = (
    sub {
        return $move_attributes->( 'Users', 'RT::User', 'AuthToken');
    },
    sub {
        return $move_attributes->( 'CustomFields', 'RT::CustomField', 'BasedOn');
    },
    sub {
        return $move_attributes->( 'CustomFields', 'RT::CustomField', 'RenderType');
    },
);
